# 백테스트 시스템 레퍼런스

## 프로젝트 개요

### 목적
- 바이낸스에서 4개 코인(BTC, ETH, XRP, SOL)의 과거 6개월 캔들 데이터를 수집
- 6개월 전부터 15분 간격으로 시간을 전진시키면서, 각 시점에서 전략 엔진이 "15분 뒤 UP/DOWN" 예측
- 15분 뒤 실제 가격과 비교하여 각 전략의 정확도를 측정
- 주간 프루닝으로 노이즈 전략 자동 제거
- 결과를 코인별 TXT 파일로 저장

### 파일 구조
```
last/
  backtest.js                          ← 메인 백테스트
  src/
    data/binance-api.js                ← API
    indicators/technical-indicators.js ← 기본 지표 계산
    indicators/all-indicators.js       ← 40개 지표 정의 + INDICATOR_LIST
    strategies/dynamic-strategy-engine.js ← 전략 엔진
```

### 의존성
```json
{ "axios": "^1.6.5", "technicalindicators": "^3.1.0" }
```
`"type": "module"` (ES Module)

---

## TXT 출력 형식 (반드시 유지)

```
═══════════════════════════════════════════════════════════
15분 업다운 테스트 결과 요약 (백테스트)
═══════════════════════════════════════════════════════════
심볼: BTCUSDT
백테스트 기간: 2025-08-12 ~ 2026-02-12
최종 업데이트: 2026. 2. 12. 오후 3:30:00

📊 전체 통계
───────────────────────────────────────────────────────────
총 예측: 17568회
정확: 9500회
정확도: 54.1%

📈 방향별 정확도
───────────────────────────────────────────────────────────
UP (BUY):   55.2% (5000/9050)
DOWN (SELL): 52.8% (4500/8518)

🔪 주간 프루닝 현황
───────────────────────────────────────────────────────────
총 프루닝된 전략: 150개 | 현재 활성 전략: 3500개
조건: 출현율 ≤1% 또는 ≥90% | 정확도 48~52%
  2025-08-19: -30개 (남은: 3650개)
  2025-08-26: -25개 (남은: 3625개)

🎯 전략별 정확도 - 총 3500개 전략 (프루닝 후)
───────────────────────────────────────────────────────────
[UP  - 1] UP: [15m] RSI(14): 과매도 65.2% (500/767)
[DOWN-??] DOWN: [15m] MACD(12,26,9): MACD 데드크로스 58.1% (300/516)
...

═══════════════════════════════════════════════════════════
```

---

## 코드 최적화 가이드

1. **메모리**: `--max-old-space-size=6144`로 실행. 6개월 × 4코인 × 4타임프레임 캔들이 메모리에 상주. 불필요한 객체 복사 금지.
2. **1m 캔들 트리밍**: `GC_EVERY`마다 오래된 1m 캔들 삭제. 1m 캔들은 **currentTime + HORIZON_MS까지** 필요하므로, 트리밍 시 미래 범위까지 보존.
3. **속도**: TICK_MS=0 (대기 없이 최대 속도). 6개월 ÷ 15분 ≈ 17,568 스텝 × 4코인. 각 스텝에서 수만 개 전략 평가. 성능 저하 없이 수정.
